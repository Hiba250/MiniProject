{% load static %}
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f0f8ff;
    margin: 0;
    padding: 20px;
  }

  h2 {
    text-align: center;
    color: #007744;
    margin-bottom: 30px;
  }

  form {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }

  input[type="text"] {
    width: 60%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px 0 0 6px;
    font-size: 16px;
  }

  button {
    padding: 10px 20px;
    background-color: #007744;
    color: white;
    border: none;
    border-radius: 0 6px 6px 0;
    font-size: 16px;
    cursor: pointer;
  }

  button:hover {
    background-color: #005f33;
  }

  #map {
    border: 2px solid #007744;
    border-radius: 8px;
  }

  h3 {
    margin-top: 40px;
    color: #005f33;
  }

  .post-card {
    background-color: #ffffff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .post-card img {
    width: 100%;
    border-radius: 6px;
    margin-bottom: 10px;
  }

  .post-card p {
    margin: 5px 0;
    font-size: 15px;
  }

  .post-card strong {
    color: #007744;
  }

  .post-card em {
    color: #666;
    font-size: 14px;
  }
</style>


<h2>üß≠ Explore Kerala</h2>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var map = L.map('map').setView([11.2588, 75.7804], 8);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var customIcon = L.icon({
      iconUrl: "{% static 'images/marker-icon.png' %}",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34]
    });

    {% for post in posts %}
      {% if post.latitude and post.longitude %}
        L.marker([{{ post.latitude }}, {{ post.longitude }}], { icon: customIcon })
          .addTo(map)
          .bindPopup(`
            <strong>{{ post.title|escapejs }}</strong><br>
            {{ post.location|escapejs }}<br>
            {% if post.photo %}
              <img src="{{ post.photo.url }}" width="150"><br>
            {% endif %}
            {{ post.description|escapejs }}
          `);
      {% endif %}
    {% endfor %}
  });
</script>


<form method="GET" action="{% url 'explore' %}">
    <input type="text" name="q" placeholder="Search locations, posts, or experiences..." value="{{ query }}">
    <button type="submit">Search</button>
</form>

<h3>üó∫Ô∏è Map of Posts</h3>
<div id="map" style="height: 400px; margin-bottom: 20px;"></div>


{% for post in posts %}
  <div class="post-card">
    {% if post.photo %}
      <img src="{{ post.photo.url }}" width="150">
    {% else %}
      <img src="{% static 'images/default.jpg' %}" width="150">
    {% endif %}
    <p><strong>{{ post.created_by.username }}</strong> shared:</p>
    <p>{{ post.description }}</p>
    <p><em>{{ post.location }}</em></p>
  </div>
{% empty %}
  <p style="text-align:center; color:#999;">No posts found for your search.</p>
{% endfor %}


